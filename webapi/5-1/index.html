<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="generator" content="Hugo 0.17-DEV" />
    <meta name="description" content="">


    <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />

    
    <title>5-1 Designing a Web API</title>
    <link href="/css/nucleus.css" rel="stylesheet">
    <link href="/css/font-awesome.min.css" rel="stylesheet">
    <link href="/css/hybrid.css" rel="stylesheet">
    <link href="/css/featherlight.min.css" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css" rel="stylesheet">
    <link href="/css/theme.css" rel="stylesheet">
    <link href="/css/hugo-theme.css" rel="stylesheet">
    <style type="text/css">:root #header + #content > #left > #rlblock_left
    {display:none !important;}</style>
    

  </head>
  <body class="" data-url="/webapi/5-1/">
    <nav id="sidebar">
  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="http://www.ipm.edu.mo/">
<b>COMP312 Internet Programming II</b>
</a>

      
    </div>
</div>


  <div class="highlightable">
    <ul class="topics">
      
      
      
      

      <li class="dd-item  " data-nav-id="/basic/">
        <a href="/basic/">
          <span>
            
              <b>2. </b>
            
             JavaScript basics
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/basic/2-1/">
              <a href="/basic/2-1/">
                <span>2-1 Basic data types and control     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/basic/2-2/">
              <a href="/basic/2-2/">
                <span>2-2 Arrays and functions     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/basic/2-3/">
              <a href="/basic/2-3/">
                <span>2-3 Objects and JSON data     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/basic/2-4/">
              <a href="/basic/2-4/">
                <span>2-4 Callbacks and arrow functions     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/basic/2-5/">
              <a href="/basic/2-5/">
                <span>2-5 Defining class     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/basic/2-6/">
              <a href="/basic/2-6/">
                <span>2-6 Regular expression     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
      
      

      <li class="dd-item  " data-nav-id="/client/">
        <a href="/client/">
          <span>
            
              <b>3. </b>
            
             Client-side programming
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/client/3-1/">
              <a href="/client/3-1/">
                <span>3-1 Quick start     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/client/3-2/">
              <a href="/client/3-2/">
                <span>3-2 Select and change     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/client/3-3/">
              <a href="/client/3-3/">
                <span>3-3 Creating new content     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/client/3-4/">
              <a href="/client/3-4/">
                <span>3-4 Handling events     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/client/3-5/">
              <a href="/client/3-5/">
                <span>3-5 Form controls     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/client/3-6/">
              <a href="/client/3-6/">
                <span>3-6 Templates     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/client/3-7/">
              <a href="/client/3-7/">
                <span>3-7 Charts     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/client/3-8/">
              <a href="/client/3-8/">
                <span>3-8 Script execution in browsers     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
      
      

      <li class="dd-item  " data-nav-id="/server/">
        <a href="/server/">
          <span>
            
              <b>4. </b>
            
             Server-side programming
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/server/4-1/">
              <a href="/server/4-1/">
                <span>4-1 Node.js primer     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/server/4-2/">
              <a href="/server/4-2/">
                <span>4-2 NPM modules     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/server/4-3/">
              <a href="/server/4-3/">
                <span>4-3 Web app routing     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/server/4-4/">
              <a href="/server/4-4/">
                <span>4-4 Web app middlewares     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/server/4-5/">
              <a href="/server/4-5/">
                <span>4-5 Templates and file modules     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/server/4-6/">
              <a href="/server/4-6/">
                <span>4-6 Database access     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/server/4-7/">
              <a href="/server/4-7/">
                <span>4-7 A sample web app     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
      
      

      <li class="dd-item  parent" data-nav-id="/webapi/">
        <a href="/webapi/">
          <span>
            
              <b>5. </b>
            
             Ajax and Web API
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item active" data-nav-id="/webapi/5-1/">
              <a href="/webapi/5-1/">
                <span>5-1 Designing a Web API     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/webapi/5-2/">
              <a href="/webapi/5-2/">
                <span>5-2 Implmenting a Web API     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/webapi/5-3/">
              <a href="/webapi/5-3/">
                <span>5-3 Consuming a Web API     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
    </ul>
    <hr>
      
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fa fa-heart"></i></a> from <a href="http://getgrav.org">Grav</a> and <a href="http://gohugo.io/">Hugo</a></p>
    </section>
  </div>
</nav>

        <section id="body">
        <div id="overlay"></div>

        <div class="padding highlightable">

            <div id="top-bar">
              
              <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                  <span id="sidebar-toggle-span">
                      <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                        <i class="fa fa-bars"></i>
                      </a>
                  </span>
                
                <span id="toc-menu"><a href=""><i class="fa fa-list-alt"></i></a></span>
                
                
                
                
                  
                
                  
                
                  
                
                  
                    
                    
                <a href="/webapi/" itemprop="url"><span itemprop="title">Ajax and Web API</span></a> <i class="fa fa-angle-right"></i>
                    
                  
                
                <span itemprop="title"> 5-1 Designing a Web API</span>
              </div>
              
                  <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#rpc-style-web-api">RPC-style Web API</a>
<ul>
<li><a href="#read-only-operations">Read-only operations</a></li>
<li><a href="#update-operations">Update operations</a></li>
</ul></li>
<li><a href="#exercise">Exercise</a></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

              

            </div>
            
    	        <div id="body-inner">
                
                <h1>5-1 Designing a Web API</h1>
                



<p>In an Ajax web app, the application server implements a Web API that provides service to the front-end JavaScript code.</p>

<p>A <dfn>Web API</dfn> is a defined set of HTTP request messages along with a definition of the structure of response messages, usually expressed in an XML or JSON format (from <a href="https://en.wikipedia.org/wiki/Web_API">Wikipedia</a>).</p>

<h2 id="rpc-style-web-api">RPC-style Web API</h2>

<p>A common design style of Web API is RPC-style (Remote Procedure Call). A RPC-style Web API consists of one URL for each <em>function or operation</em>.  These URLs represent an action and are usually named with a verb.  The following table shows the five endpoints in the Web API of our sample web app. They implement four common operations on data known as CRUD (Create, Retrieve, Update an Delete).</p>

<table>
<thead>
<tr>
<th>method</th>
<th>URL</th>
<th>function</th>
</tr>
</thead>

<tbody>
<tr>
<td>GET</td>
<td>/getTodo</td>
<td>List all tasks in json format</td>
</tr>

<tr>
<td>GET</td>
<td>/searchTodo</td>
<td>Search tasks that are due before the given date.</td>
</tr>

<tr>
<td>POST</td>
<td>/addTodo</td>
<td>Add a task. Message body contains properties of the new task, except id.</td>
</tr>

<tr>
<td>POST</td>
<td>/updateTodo</td>
<td>Update a task. Message body contains id of the updated todo and properties with new value</td>
</tr>

<tr>
<td>POST</td>
<td>/deleteTodo</td>
<td>Delete the task with id included in message body</td>
</tr>
</tbody>
</table>

<p>An endpoint uses <strong>GET</strong> if the operation is <em>read-only</em>. If the operation may causes some action or side-effect on the server side, the endpoint must use <strong>POST</strong>.</p>

<h3 id="read-only-operations">Read-only operations</h3>

<p>A Web API may return result in either key-value pairs (www-url-encoded) or JSON.
Key-value pairs are only suitable for simple values. JSON is more flexible in representing data structure.</p>

<p>Sample request message to retrieve tasks:</p>

<pre><code class="language-HTTP">GET /getTodo HTTP/1.1
Host: example.com

</code></pre>

<p>Below is a sample response message returned by the Web API. The JSON payload has <code>Content-type: applicatin/json</code>. The <a href="http://www.json.org/">JSON data format</a> is mostly the same as JavaScript object syntax. But it can only contain simple values (namely numbers, strings and boolean) and all property names must be quoted.</p>

<pre><code class="language-HTTP">HTTP/1.1 200 Ok
Content-type: application/json
Content-length: 234

{
  &quot;count&quot;: 2,
  &quot;task&quot;: [     
    { &quot;id&quot;: 1, &quot;due&quot;: &quot;2016-11-11&quot;, &quot;what&quot;: &quot;Test&quot;,
      &quot;category&quot;: &quot;study&quot;, &quot;done&quot;: 0 },
    { &quot;id&quot;: 2, &quot;due&quot;: &quot;2016-12-13&quot;, &quot;what&quot;: &quot;Final exam&quot;,
      &quot;category&quot;: &quot;study&quot;, &quot;done&quot;: 0 }
  ]
}
</code></pre>

<p>A client may pass simple parameters to the Web API using <em>query</em>. This is similar to web search form submission. Below is a request for the endpoint <code>GET /searchTodo</code> to search tasks that are due before a given date. Note that HTTP GET requests <em>cannot</em> contain a body, so any data must be passed in the URL.</p>

<pre><code class="language-HTTP">GET /searchTodo?before=2016-12-01 HTTP/1.1
Host: example.com

</code></pre>

<p>Some designers use HTTP status codes like <code>400</code> and <code>500</code> to report runtime error. Other designers choose to use the JSON payload to report error. What is important is that you should be consistent.</p>

<pre><code class="language-HTTP">HTTP/1.1 400 Bad Request
Content-type: text/plain
Content-length: 26

Date format error in input
</code></pre>

<pre><code class="language-HTTP">HTTP/1.1 500 Internal Server Error
Content-type: application/json
Content-length: 63

{ &quot;errorCode&quot;: 1001, &quot;message&quot;: &quot;Database connection problem&quot; }
</code></pre>

<pre><code class="language-HTTP">HTTP/1.1 200 Ok
Content-type: application/json
Content-length: 63

{ &quot;errorCode&quot;: 1001, &quot;message&quot;: &quot;Database connection problem&quot; }
</code></pre>

<h3 id="update-operations">Update operations</h3>

<p>The endpoints of any update operations <strong>must use POST</strong>. It informs that any web proxy servers between the client and the Web API should not cache response of the operations. In update operations, there are usually some input parameters. You can pass simple parameters as key-value pairs (i.e. <code>www-form-urlencoded</code>) in the request message body. Key-value pairs are usually easier to work with in client-side programming (e.g. using jQuery).</p>

<p>Below is a sample request for adding a task in the Web API.</p>

<pre><code class="language-HTTP">POST /addTodo HTTP/1.1
Host: example.com
Content-type: application/x-www-form-urlencoded
Content-length: 53

due=2017-01-06&amp;what=Makeup+exam&amp;category=study&amp;done=0
</code></pre>

<p>For more complicated data, use JSON data format.</p>

<pre><code class="language-HTTP">POST /addTodo HTTP/1.1
Host: example.com
Content-type: application/json
Content-length: 80

{ &quot;due&quot;: &quot;2017-01-06&quot;, &quot;what&quot;: &quot;Makeup exam&quot;,
  &quot;category&quot;: &quot;study&quot;, &quot;done&quot;: 0 }
</code></pre>

<p>A <em>successful response</em> from an update operation may not contain any payload. You can use HTTP status code <code>204</code> in this case.</p>

<pre><code class="language-HTTP">HTTP/1.1 204 No content

</code></pre>

<p>On the other hand, if the Web API provides some info about the update operation, include the data as urlencoded or JSON payload.</p>

<pre><code class="language-HTTP">HTTP/1.1 200 Ok
Content-type: application/x-www-form-urlencoded
Content-length: 4

id=21
</code></pre>

<p>We finish this section with sample HTTP request and response messages for the remaining two endpoints of the Web API, namely <code>POST /updateTodo</code> and <code>POST /deleteTodo</code>.</p>

<p>In the updateTodo operation, the client must specify the <code>id</code> of the task to change, and then list the properties and their new values.</p>

<pre><code class="language-HTTP">POST /updateTodo HTTP/1.1
Host: example.com
Content-type: application/x-www-form-urlencoded
Content-length: 53

id=21&amp;what=Makeup+exam+COMP312
</code></pre>

<p>For the delete operation, the client must specify the <code>id</code> of the task to delete. The input parameter is very simple. There are two common designs for this case.</p>

<pre><code class="language-HTTP">POST /deleteTodo HTTP/1.1
Host: example.com
Content-type: application/x-www-form-urlencoded
Content-length: 4

id=3
</code></pre>

<p>or</p>

<pre><code class="language-HTTP">POST /deleteTodo?id=3 HTTP/1.1
Host: example.com

</code></pre>

<p>We&rsquo;ll use the first design in our sample app for consistency. I.e. we also pass input parameters to POST endpoints in request message body.</p>

<h2 id="exercise">Exercise</h2>

<ol>
<li><p>Write sample response messages for the <code>POST /updateTodo</code> endpoint for successful update, and unsuccessful update because the record with the given id does not exist.</p></li>

<li><p>Design a new endpoint <code>GET /getTodoWithId</code>, to retrieve a task with a given <code>id</code>. Write sample response messages for successful and unsuccessful retrieval.</p></li>

<li><p>Design a new endpoint for the Web API for the operation of marking a task as done (i.e. set the done property to 1 in the server database.) Write sample response messages for successful and unsuccessful retrieval. In your answer, describe what input parameters are required.</p></li>
</ol>


      
      </div>
    </div>

    <div id="navigation">
        
        
    </div>

    </section>
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/jquery-2.x.min.js"></script>
    <script src="/js/clipboard.min.js"></script>
    <script src="/js/perfect-scrollbar.min.js"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js"></script>
    <script src="/js/jquery.sticky-kit.min.js"></script>
    <script src="/js/featherlight.min.js"></script>
    <script src="/js/html5shiv-printshiv.min.js"></script>
    <script src="/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom.71422.js"></script>
    <script src="/js/learn.js"></script>
    <script src="/js/hugo-learn.js"></script>
    

  </body>
</html>

