<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="generator" content="Hugo 0.26" />
    <meta name="description" content="">


    <title>4-3 Web app routing :: COMP312 labs</title>
    <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
    <link href="/css/nucleus.css" rel="stylesheet">
    <link href="/css/font-awesome.min.css" rel="stylesheet">
    <link href="/css/hybrid.css" rel="stylesheet">
    <link href="/css/featherlight.min.css" rel="stylesheet">
    <link href="/css/horsey.css" rel="stylesheet">
    
    <link href="/css/theme.css" rel="stylesheet">
    
    
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <script src="/js/jquery-2.x.min.js"></script>
    <style type="text/css">
      :root #header + #content > #left > #rlblock_left {
        display:none !important;
      }
    </style>

    

    

  </head>
  <body class="" data-url="/server/4-3/">
    <nav id="sidebar" class="">





<div class="highlightable">
  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="http://www.ipm.edu.mo/">
<b>COMP312 Internet Programming II</b>
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fa fa-search"></i></label>
    <input data-search-input id="search-by" type="text" placeholder="Search...">
    <span data-search-clear=""><i class="fa fa-close"></i></span>
</div>
<script type="text/javascript" src="/js/lunr.min.js"></script>
<script type="text/javascript" src="/js/horsey.js"></script>
<script type="text/javascript">
    var baseurl = "http:\/\/philiplei.github.io\/";
</script>
<script type="text/javascript" src="/js/search.js"></script>

    
  </div>

  
    <ul class="topics">
        
            <li data-nav-id="/" class="dd-item">
            <a href="/"><i class="fa fa-fw fa-home"></i></a>
            </li>
        
        
        
          
          


 
  
    
    <li data-nav-id="/webapi/" class="dd-item 
        
        
        
        ">
      <a href="/webapi/">
        <span>Webapis</span>

        
        

          
            <i class="fa fa-angle-right fa-lg category-icon"></i>
          

        

        
      </a>
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/webapi/5-1/" class="dd-item
     
      ">
        <a href="/webapi/5-1/">
        <span>5-1 Designing a Web API</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/webapi/5-2/" class="dd-item
     
      ">
        <a href="/webapi/5-2/">
        <span>5-2 Implementing a Web API</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/webapi/5-3/" class="dd-item
     
      ">
        <a href="/webapi/5-3/">
        <span>5-3 Consuming a Web API</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/webapi/" class="dd-item
     
      ">
        <a href="/webapi/">
        <span>Ajax and Web API</span> 
        
        </a></li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/server/" class="dd-item 
        parent
        
        
        ">
      <a href="/server/">
        <span>Servers</span>

        
        

          
            <i class="fa fa-angle-down fa-lg category-icon"></i>
          

        

        
      </a>
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/server/4-1/" class="dd-item
     
      ">
        <a href="/server/4-1/">
        <span>4-1 Node.js primer</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/server/4-2/" class="dd-item
     
      ">
        <a href="/server/4-2/">
        <span>4-2 NPM modules</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/server/4-3/" class="dd-item
     active
      ">
        <a href="/server/4-3/">
        <span>4-3 Web app routing</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/server/4-4/" class="dd-item
     
      ">
        <a href="/server/4-4/">
        <span>4-4 Web app middlewares</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/server/4-5/" class="dd-item
     
      ">
        <a href="/server/4-5/">
        <span>4-5 Templates and file modules</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/server/4-6/" class="dd-item
     
      ">
        <a href="/server/4-6/">
        <span>4-6 Database access</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/server/4-7/" class="dd-item
     
      ">
        <a href="/server/4-7/">
        <span>4-7 A sample web app</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/server/" class="dd-item
     
      ">
        <a href="/server/">
        <span>Server-side programming</span> 
        
        </a></li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/client/" class="dd-item 
        
        
        
        ">
      <a href="/client/">
        <span>Clients</span>

        
        

          
            <i class="fa fa-angle-right fa-lg category-icon"></i>
          

        

        
      </a>
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/client/3-1/" class="dd-item
     
      ">
        <a href="/client/3-1/">
        <span>3-1 Quick start</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/client/3-2/" class="dd-item
     
      ">
        <a href="/client/3-2/">
        <span>3-2 Select and change</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/client/3-3/" class="dd-item
     
      ">
        <a href="/client/3-3/">
        <span>3-3 Creating new content</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/client/3-4/" class="dd-item
     
      ">
        <a href="/client/3-4/">
        <span>3-4 Handling events</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/client/3-5/" class="dd-item
     
      ">
        <a href="/client/3-5/">
        <span>3-5 Form controls</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/client/3-6/" class="dd-item
     
      ">
        <a href="/client/3-6/">
        <span>3-6 Templates</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/client/3-7/" class="dd-item
     
      ">
        <a href="/client/3-7/">
        <span>3-7 Charts</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/client/3-8/" class="dd-item
     
      ">
        <a href="/client/3-8/">
        <span>3-8 Script execution in browsers</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/client/" class="dd-item
     
      ">
        <a href="/client/">
        <span>Client-side programming</span> 
        
        </a></li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/basic/" class="dd-item 
        
        
        
        ">
      <a href="/basic/">
        <span>Basics</span>

        
        

          
            <i class="fa fa-angle-right fa-lg category-icon"></i>
          

        

        
      </a>
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/basic/2-1/" class="dd-item
     
      ">
        <a href="/basic/2-1/">
        <span>2-1 Basic data types and control</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/basic/2-2/" class="dd-item
     
      ">
        <a href="/basic/2-2/">
        <span>2-2 Arrays and functions</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/basic/2-3/" class="dd-item
     
      ">
        <a href="/basic/2-3/">
        <span>2-3 Objects and JSON data</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/basic/2-4/" class="dd-item
     
      ">
        <a href="/basic/2-4/">
        <span>2-4 Callbacks and arrow functions</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/basic/2-5/" class="dd-item
     
      ">
        <a href="/basic/2-5/">
        <span>2-5 Defining class</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/basic/2-6/" class="dd-item
     
      ">
        <a href="/basic/2-6/">
        <span>2-6 Regular expression</span> 
        
        </a></li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/basic/" class="dd-item
     
      ">
        <a href="/basic/">
        <span>JavaScript basics</span> 
        
        </a></li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
        

        
    </ul>
    
     
    <section id="footer">
      
    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
        
          <div id="top-bar">
            

            <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                <span id="sidebar-toggle-span">
                  <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                    <i class="fa fa-bars"></i>
                  </a>
                </span>
                <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
                <span class="links">
                







 <a href='/'>COMP312 labs</a> > <a href='/server/'>Servers</a> > 4-3 Web app routing

 

 

   
                </span>
            </div>
            <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#routes">Routes</a></li>
<li><a href="#making-responses">Making responses</a></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

          </div>
        
        
        <div id="body-inner">
          
            <h1>4-3 Web app routing</h1>
          






<p>Express.js <a href="http://expressjs.com/">(official website)</a> is a web framework to simplify development of Web applications. It supports:</p>

<ul>
<li>Routing – different request processing based on URL patterns</li>
<li>Middleware – chainable processing of requests and responses</li>
<li>Template – generate HTML output from variables</li>
</ul>

<p>This lab covers how to define routes to capture HTTP requests for a web app / service endpoints. In addition, we&rsquo;ll discuss how to generate simple HTTP responses.</p>

<h2 id="routes">Routes</h2>

<p>This example shows the basic structure of an Express app.</p>

<pre><code class="language-JavaScript">var express = require('express');
// create an Express application, which will handle HTTP requests
var app = express();

// a route in the app, which handles GET request for the path '/'
app.get('/', (req, res) =&gt; {
  res.send('hello world');
});

// more routes ...

// start listening at TCP port 3000
app.listen(3000);
</code></pre>

<p>When a web app receives an HTTP request, it has to decide how to handle the request, and return the result as an HTTP response.  Such decision usually depends on the HTTP method (either GET or POST in most cases) and the path in the URL (e.g. &ldquo;/about.html&rdquo;).   The combination of HTTP method and the URL path is usually referred to as an <strong>endpoint</strong> of the web app or web service.</p>

<p>In an Express app, we define a <strong>route</strong> to describe how to process HTTP requests at an endpoint.
The general syntax is <code>app.get(path, callback)</code> and <code>app.post(path, callback)</code>. The callback can take 2 or more parameters.  Often, we only use the first two parameters called <code>req</code> and <code>res</code>: <code>req</code> refers to the incoming HTTP request, and <code>res</code> is an object that is used to build the HTTP response. The following is a route for GET request at URL &lsquo;/about.html&rsquo;. The route returns a text response.</p>

<pre><code class="language-JavaScript">// app is an Express app

app.get('/about.html', (req, res) =&gt; {
  // When the Express app receives a GET request
  // for the path '/about.html', it returns a text response
  res.send('This is a simple example of route')
});
</code></pre>

<p>Some web apps include parameters in the URL path. For example, the URL <a href="https://www.google.com/maps/place/Macao+Polytechnic+Institute/">https://www.google.com/maps/place/Macao+Polytechnic+Institute/</a> refers to the place &lsquo;Macao Polytechnic Institute&rsquo; in the Google Maps web app.  You can easily extract these parameters in Express routes.</p>

<p>Consider the sample code below, which shows a web app to check lecture hours. When the app receives a GET request for the path &lsquo;/lecture/comp312&rsquo;, it returns a response of its lecture hours. The parameters are available in the object <code>req.params</code>. (The full source is <a href="/chap4-3/app1.js">app1.js</a>).</p>

<pre><code class="language-JavaScript">// retrieve the lecture time
app.get('/lecture/:code', (req, res) =&gt; {
  // in a real app, we'd query a database ...
  if (req.params.code=='comp312') {
    res.send('Tue, Thu: 10:00-11:30am')
  } else if (req.params.code=='comp311') {
    // ...
  }
})
</code></pre>

<p>The above only describes the basics of routing in Express. Refer to the <a href="http://expressjs.com/en/guide/routing.html">online guide</a> for more possibilities.</p>

<p><strong>The order of routes is significant!</strong>  An Express app checks the routes in the order they are defined. When a route matches the HTTP methods and URL path, the Express app executes its callback function to handle the request.  The callback usually returns an HTTP response with <code>res.send()</code> or similar methods. When a response is returned, the Express app will <strong>stop</strong> checking the remaining routes.</p>

<pre><code class="language-JavaScript">app.get('/lecture/comp312', (req, res) =&gt; {
  // special response for comp312
  res.send('...');
});

// retrieve the lecture time
app.get('/lecture/:code', (req, res) =&gt; {
  // search database, return a response
  res.send('...');
});

app.get('/lecture/comp113', (req, res) =&gt; {
  // special response for comp113. But sorry, this route never runs!
  res.send('...');
});
</code></pre>

<h2 id="making-responses">Making responses</h2>

<p>You can use the <code>res</code> object in the route callback to build a response. <a href="http://expressjs.com/en/4x/api.html#res">(online reference)</a> The <code>res</code> object has several common methods:</p>

<ul>
<li><code>res.send(body)</code> sends a response with the specified body. The body is usually a string, but it can also be JavaScript objects or others.  The method determines the suitable MIME type.</li>
<li><code>res.sendFile(path)</code> returns a file as response.</li>
<li><code>res.status(code)</code> sets the HTTP response code. This function is chainable.</li>
<li><code>res.redirect(path)</code> redirects to the given URL.</li>
</ul>

<p>Check the source code of <a href="/chap4-3/app2.js">app2.js</a> for demonstration of how to build responses with these methods.</p>


<footer class=" footline" >
	
</footer>



      </div>
    </div>

    
 
    

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
        
        


        
            <a class="nav nav-prev" href="/server/4-7/" title="4-7 A sample web app"> <i class="fa fa-chevron-left"></i></a>
        
        
            <a class="nav nav-next" href="/client/" title="Clients" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
        
    </div>

    </section>
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js"></script>
    <script src="/js/featherlight.min.js"></script>
    <script src="/js/html5shiv-printshiv.min.js"></script>
    <script src="/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom.71422.js"></script>
    <script src="/js/learn.js"></script>
    <script src="/js/hugo-learn.js"></script>

    
    <link href="/mermaid/mermaid.css" type="text/css" rel="stylesheet"/>
    <script src="/mermaid/mermaid.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    

    

  </body>
</html>

