<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="generator" content="Hugo 0.17-DEV" />
    <meta name="description" content="">


    <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />

    
    <title>4-3 Web client</title>
    <link href="/css/nucleus.css" rel="stylesheet">
    <link href="/css/font-awesome.min.css" rel="stylesheet">
    <link href="/css/hybrid.css" rel="stylesheet">
    <link href="/css/featherlight.min.css" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css" rel="stylesheet">
    <link href="/css/theme.css" rel="stylesheet">
    <link href="/css/hugo-theme.css" rel="stylesheet">
    <style type="text/css">:root #header + #content > #left > #rlblock_left
    {display:none !important;}</style>
    

  </head>
  <body class="" data-url="/server/4-3/">
    <nav id="sidebar">
  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="http://www.ipm.edu.mo/">
<b>COMP312 Internet Programming II</b>
</a>

      
    </div>
</div>


  <div class="highlightable">
    <ul class="topics">
      
      
      
      

      <li class="dd-item  " data-nav-id="/basic/">
        <a href="/basic/">
          <span>
            
              <b>2. </b>
            
             JavaScript basics
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/basic/2-1/">
              <a href="/basic/2-1/">
                <span>2-1 Basic data types and control     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/basic/2-2/">
              <a href="/basic/2-2/">
                <span>2-2 Arrays and functions     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/basic/2-3/">
              <a href="/basic/2-3/">
                <span>2-3 Objects and JSON data     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/basic/2-4/">
              <a href="/basic/2-4/">
                <span>2-4 Callbacks and arrow functions     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/basic/2-5/">
              <a href="/basic/2-5/">
                <span>2-5 Defining class     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/basic/2-6/">
              <a href="/basic/2-6/">
                <span>2-6 Regular expression     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
      
      

      <li class="dd-item  " data-nav-id="/client/">
        <a href="/client/">
          <span>
            
              <b>3. </b>
            
             Client-side programming
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/client/3-1/">
              <a href="/client/3-1/">
                <span>3-1 Quick start     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/client/3-2/">
              <a href="/client/3-2/">
                <span>3-2 Select and change     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/client/3-3/">
              <a href="/client/3-3/">
                <span>3-3 Creating new content     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/client/3-4/">
              <a href="/client/3-4/">
                <span>3-4 Handling events     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/client/3-5/">
              <a href="/client/3-5/">
                <span>3-5 Form controls     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/client/3-6/">
              <a href="/client/3-6/">
                <span>3-6 Templates     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/client/3-7/">
              <a href="/client/3-7/">
                <span>3-7 Charts     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/client/3-8/">
              <a href="/client/3-8/">
                <span>3-8 Script execution in browsers     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
      
      

      <li class="dd-item  parent" data-nav-id="/server/">
        <a href="/server/">
          <span>
            
              <b>4. </b>
            
             Server-side programming
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/server/4-1/">
              <a href="/server/4-1/">
                <span>4-1 Node.js primer     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/server/4-2/">
              <a href="/server/4-2/">
                <span>4-2 Events     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item active" data-nav-id="/server/4-3/">
              <a href="/server/4-3/">
                <span>4-3 Web client     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/server/4-4/">
              <a href="/server/4-4/">
                <span>4-4 Routing in web app     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/server/4-5/">
              <a href="/server/4-5/">
                <span>4-5 Middleware in web app     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/server/4-6/">
              <a href="/server/4-6/">
                <span>4-6 Template in web app     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/server/4-7/">
              <a href="/server/4-7/">
                <span>4-7 Database access     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
    </ul>
    <hr>
      
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fa fa-heart"></i></a> from <a href="http://getgrav.org">Grav</a> and <a href="http://gohugo.io/">Hugo</a></p>
    </section>
  </div>
</nav>

        <section id="body">
        <div id="overlay"></div>

        <div class="padding highlightable">

            <div id="top-bar">
              
              <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                  <span id="sidebar-toggle-span">
                      <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                        <i class="fa fa-bars"></i>
                      </a>
                  </span>
                
                <span id="toc-menu"><a href=""><i class="fa fa-list-alt"></i></a></span>
                
                
                
                
                  
                
                  
                
                  
                    
                    
                <a href="/server/" itemprop="url"><span itemprop="title">Server-side programming</span></a> <i class="fa fa-angle-right"></i>
                    
                  
                
                <span itemprop="title"> 4-3 Web client</span>
              </div>
              
                  <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#module-request">Module request</a></li>
<li><a href="#get-an-url">GET an URL</a></li>
<li><a href="#options-object-pattern">Options object pattern</a></li>
<li><a href="#post-request">POST request</a></li>
<li><a href="#exercise">Exercise</a></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

              

            </div>
            
    	        <div id="body-inner">
                
                <h1>4-3 Web client</h1>
                



<p>This lab demonstrate how send HTTP requests using the <code>request</code> modules.</p>

<h2 id="module-request">Module request</h2>

<p>Node.js has a built-in module called <code>http</code> and <code>https</code> for making HTTP clients and servers. They are efficient implementation of the HTTP protocol. However, the modules are low-level and not convenient to use. Therefore, the Node community has developed several modules for writing HTTP clients and servers. This lab is about the client-side of HTTP.</p>

<p>A popular choice for HTTP clients is the <code>request</code> module. <a href="https://www.npmjs.com/package/request">(online reference)</a>.  Before using the module the first time in a project, install it with <code>npm install request</code>.</p>

<h2 id="get-an-url">GET an URL</h2>

<p>The following example fetches the current weather report from <a href="http://rss.smg.gov.mo/e_ActualWeather_rss.xml">http://rss.smg.gov.mo/e_ActualWeather_rss.xml</a>.</p>

<pre><code class="language-JavaScript">// p301.js
var request = require('request');

var url = 'http://rss.smg.gov.mo/e_ActualWeather_rss.xml';
request.get(url, (err, res, body) =&gt; {
  console.log('STATUS: ' + res.statusCode);
  console.log('HEADERS: ');
  console.dir(res.headers);
  console.log(body);
});
</code></pre>

<p>The callback for <code>request.get</code> takes three parameters. The first is the error object. The second is an object of class <code>http.IncomingMessage</code> <a href="https://nodejs.org/api/http.html#http_class_http_incomingmessage">(online reference)</a>. It represent the HTTP response message. You can use it to check HTTP status code and headers. The last parameter is the message body of the HTTP response.   The next example downloads an image from IPM website and saves it.</p>

<h2 id="options-object-pattern">Options object pattern</h2>

<p>The JavaScript programming language does not support named parameters.  Some APIs make use of a pattern caled <strong>options object pattern</strong> to pass named parameters to a function. For example, if you need to give more information about the HTTP request in addition to URL, you can group these information in an option object and pass it as the first parameter of <code>reqeust.get()</code>. Refer to online reference for <a href="https://www.npmjs.com/package/request#requestoptions-callback">all available options</a>.</p>

<pre><code class="language-JavaScript">// p302.js
// - Download and save an image file from www.ipm.edu.mo

var fs = require('fs');
var request = require('request');

// options object pattern
// use a JS object to group named parameters
// encoding = null is required to get binary data
var options = {
  url: 'http://www.ipm.edu.mo/cntfiles/upload/images/common/campus/campusmap_btn_chi_un_img.jpg',
  encoding: null
};

request.get(options, (err, res, body) =&gt; {
  if (err) throw err;
  if (res.statusCode!==200) {
    console.log('HTTP status not ok. code = ', res.statusCode);
    return;
  }
  console.log('HTTP request is successful. Saving file...');
  fs.writeFile('campus.jpg', body, (err) =&gt; {
    if (err) throw err;
  });
});
</code></pre>

<h2 id="post-request">POST request</h2>

<p>In the next example, we want to download the class time table from the IPM web app at
<a href="https://wapps.ipm.edu.mo/siweb/time_prog.asp">https://wapps.ipm.edu.mo/siweb/time_prog.asp</a>.
The web app uses HTTPS (instead of plain HTTP) and the POST method to send query to the server.
The query data can be sent using the <code>form</code> property in the <code>options</code> object in <code>request.post</code>.</p>

<pre><code class="language-JavaScript">// p303.js
// - saves the response of a POST request to the file timetab.html

var request = require('request');
var fs = require('fs');

var form = {
  p_escl_cod: 5, /* ... */
  p_year_sem: '2015/2016-1',
  p_sp_year: 3,
  p_class_code: '31121'
};

var options = {
  url: 'https://wapps.ipm.edu.mo/siweb/time_prog.asp',
  form: form
};

request.post(options, (err, res, body) =&gt; {
  if (err) throw err;
  console.log('HTTP status: ' + res.statusCode);
  // write the HTML response body to an HTML file
  fs.writeFile('timetab.html', body, 'utf8', (err)=&gt; {} );
});
</code></pre>

<h2 id="exercise">Exercise</h2>

<p>TODO TODO</p>


      
      </div>
    </div>

    <div id="navigation">
        
        
    </div>

    </section>
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/jquery-2.x.min.js"></script>
    <script src="/js/clipboard.min.js"></script>
    <script src="/js/perfect-scrollbar.min.js"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js"></script>
    <script src="/js/jquery.sticky-kit.min.js"></script>
    <script src="/js/featherlight.min.js"></script>
    <script src="/js/html5shiv-printshiv.min.js"></script>
    <script src="/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom.71422.js"></script>
    <script src="/js/learn.js"></script>
    <script src="/js/hugo-learn.js"></script>
    

  </body>
</html>

